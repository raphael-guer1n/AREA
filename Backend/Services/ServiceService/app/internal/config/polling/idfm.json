{
  "name": "idfm",
  "payload_format": "json",
  "interval_seconds": 60,
  "request": {
    "method": "GET",
    "url_template": "https://prim.iledefrance-mobilites.fr/marketplace/v2/navitia/line_reports/lines/line:IDFM:{{config.line_id}}/line_reports",
    "query_params": {
      "disable_geojson": "true",
      "language": "fr-FR"
    },
    "headers": {
      "apikey": "{{env.IDFM_API_TOKEN}}"
    }
  },
  "item_sources": [
    {
      "name": "disruptions",
      "items_path": "disruptions",
      "item_id_path": "id",
      "context": {
        "line": "line_reports[0].line"
      },
      "filters": {
        "mode": "all",
        "rules": [
          {
            "json_path": "tags[0]",
            "operator": "equals",
            "value": "Actualité"
          },
          {
            "json_path": "cause",
            "operator": "equals",
            "value": "perturbation"
          },
          {
            "json_path": "severity.name",
            "operator": "in",
            "values": [
              "bloquante",
              "perturbée"
            ]
          },
          {
            "json_path": "status",
            "operator": "equals",
            "value": "active"
          }
        ]
      },
      "mappings": [
        {
          "field_key": "line_id",
          "json_path": "line.id",
          "type": "string",
          "optional": true
        },
        {
          "field_key": "line_name",
          "json_path": "line.name",
          "type": "string",
          "optional": true
        },
        {
          "field_key": "severity_name",
          "json_path": "severity.name",
          "type": "string"
        },
        {
          "field_key": "severity_effect",
          "json_path": "severity.effect",
          "type": "string",
          "optional": true
        },
        {
          "field_key": "message",
          "json_path": "messages[0].text",
          "type": "string",
          "optional": true
        },
        {
          "field_key": "updated_at",
          "json_path": "updated_at",
          "type": "string",
          "optional": true
        }
      ]
    }
  ]
}
